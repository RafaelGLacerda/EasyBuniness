<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard da Empresa</title>
  <link rel="stylesheet" href="main.css" />
</head>
<body>
  <div class="dashboard-container">
    <button class="logout-btn" onclick="logout()">SAIR</button>

    <div class="top-section">
      <div class="empresa-info">
        <h2 id="empresaNome"></h2>
        <p><strong>Produtos:</strong> <span id="qtdProdutos">0</span></p>
        <p><strong>Telefone:</strong> <span id="telefone"></span></p>
        <p><strong>Contatos:</strong> <span id="contato"></span></p>
        <p><strong>Endereço:</strong> <span id="endereco"></span></p>
        <label>
          <input type="checkbox" id="statusCheckbox" />
          Empresa Aberta
        </label>
      </div>

      <div class="add-produto-container">
        <button onclick="window.location.href='produtos.html'">Adicionar novo produto</button>
      </div>
    </div>

    <div class="produtos-grid" id="listaProdutos"></div>
  </div>

  <script>
    const empresa = JSON.parse(localStorage.getItem('empresa'));

    if (!empresa) {
      alert('Faça login primeiro.');
      window.location.href = 'index.html';
    }

    // Preenche dados
    document.getElementById('empresaNome').textContent = empresa.nome;
    document.getElementById('telefone').textContent = empresa.telefone || '-';
    document.getElementById('contato').textContent = empresa.contato || '-';
    document.getElementById('endereco').textContent = empresa.endereco || '-';
    document.getElementById('qtdProdutos').textContent = empresa.produtos.length;
    document.getElementById('statusCheckbox').checked = empresa.status === 'Aberta';

    // Atualiza status da empresa
    document.getElementById('statusCheckbox').addEventListener('change', async () => {
      const novoStatus = statusCheckbox.checked ? 'Aberta' : 'Fechada';
      try {
        const res = await fetch('http://localhost:3000/api/status', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: empresa.email, status: novoStatus })
        });

        if (res.ok) {
          empresa.status = novoStatus;
          localStorage.setItem('empresa', JSON.stringify(empresa));
        }
      } catch {
        alert('Erro ao atualizar status.');
      }
    });

    // Lista produtos
    const lista = document.getElementById('listaProdutos');
    empresa.produtos.forEach((p, i) => {
      const card = document.createElement('div');
      card.className = 'produto-card';
      card.innerHTML = `
        <img src="${p.imagem}" alt="${p.nome}" class="produto-img">
        <h3>${p.nome}</h3>
        <p>${p.descricao}</p>
        <p><strong>R$ ${p.preco}</strong></p>
        <button onclick="editarProduto(${i})">EDITAR PRODUTO</button>
      `;
      lista.appendChild(card);
    });

    function editarProduto(index) {
      localStorage.setItem('produtoEdit', index);
      window.location.href = 'produtos.html';
    }

    function logout() {
      localStorage.removeItem('empresa');
      window.location.href = 'index.html';
    }
  </script>
</body>
</html>
